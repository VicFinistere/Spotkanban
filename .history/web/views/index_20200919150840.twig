{% extends "layout.html" %}

{% block content %}
<main role="main">

  <section class="jumbotron text-center">
    <div class="container">
      <h1>Kanban</h1>
      <p class="lead text-muted">That's a MySQL, PHP, Javascript kanban board !</p>
      <small>
        <p class="text-muted">With this board you can manage your tasks.</p>
      </small>
      <p>
      <nav class="nav nav-pills nav-justified">
      <a class="nav-item nav-link btn btn-primary my-2" data-toggle="modal" data-target="#myLoginModal">Connect</a>
      <a class="nav-item nav-link btn btn-light my-2"card-link" onclick="addTask()">Add a task</a>
    </nav>
      </p>
    </div>
  </section>

  <div class="album py-5 bg-light">
    <div class="container">

      <div class="row">
        <div class="col-md-3">
          <div class="card mb-3 shadow-sm">
            <svg class="bd-placeholder-img card-img-top" width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Backlog"><title>Placeholder</title><rect width="100%" height="100%" fill="#cb6217"/><text x="50%" y="50%" fill="#eceeef" dy=".3em">Backlog</text></svg>
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted"><p style="color:#cb6217">Next tasks...</p></small>
              </div>
                <ul class="list-group list-group-flush">
    {% for task in tasks %}
  {% if task.2 == "BACKLOG" %}
  <li class="list-group-item" onclick="modifyTask('{{task.0}}', '{{task.1}}', '{{task.2}}', '{{task.3}}');">
  {{task.1}}
  </li>
  {% endif %}
  {% endfor %}
  </ul>
  <div class="card-body text-right">
    <button type="button" class="btn btn-light my-2"card-link" onclick="addTask()">Add a task</button>
  </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card mb-3 shadow-sm">
            <svg class="bd-placeholder-img card-img-top" width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: To Do"><title>Placeholder</title><rect width="100%" height="100%" fill="#F95E5B"/><text x="50%" y="50%" fill="#eceeef" dy=".3em">To Do</text></svg>
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted"><p style="color:#F95E5B">Tasks</p></small>
              </div>
                <ul class="list-group list-group-flush">
    {% for task in tasks %}
  {% if task.2 == "TODO" %}
  <li class="list-group-item" onclick="modifyTask('{{task.0}}', '{{task.1}}', '{{task.2}}', '{{task.3}}');">
  {{task.1}}
  </li>
  {% endif %}
  {% endfor %}
  </ul>
 <div class="card-body text-right">
    <button type="button" class="btn btn-light my-2"card-link" onclick="addTask()">Add a task</button>
  </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card mb-3 shadow-sm">
            <svg class="bd-placeholder-img card-img-top" width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Doing"><title>Placeholder</title><rect width="100%" height="100%" fill="#6284FB"/><text x="50%" y="50%" fill="#eceeef" dy=".3em">Doing</text></svg>
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
              <small class="text-muted"><p style="color:#6284FB">Current tasks</p></small>
              </div>
              <ul class="list-group list-group-flush">
    {% for task in tasks %}
  {% if task.2 == "DOING" %}
  <li class="list-group-item" onclick="modifyTask('{{task.0}}', '{{task.1}}', '{{task.2}}', '{{task.3}}');">
  {{task.1}}
  </li>
  {% endif %}
  {% endfor %}
  </ul>
  <div class="card-body text-right">
    <button type="button" class="btn btn-light my-2"card-link" onclick="addTask()">Add a task</button>
  </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card mb-3 shadow-sm">
            <svg class="bd-placeholder-img card-img-top" width="100%" height="225" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Done"><title>Placeholder</title><rect width="100%" height="100%" fill="#2FB4DE"/><text x="50%" y="50%" fill="#eceeef" dy=".3em">Done</text></svg>
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted"><p style="color:#2FB4DE">Achieved</p></small>
              </div>
                <ul class="list-group list-group-flush">
    {% for task in tasks %}
  {% if task.2 == "DONE" %}
  <li class="list-group-item" onclick="modifyTask('{{task.0}}', '{{task.1}}', '{{task.2}}', '{{task.3}}');">
  {{task.1}}
  </li>
  {% endif %}
  {% endfor %}
  </ul>
  <div class="card-body text-right">
    <button type="button" class="btn btn-light my-2"card-link" onclick="addTask()">Add a task</button>
  </div>
            </div>
          </div>
        </div>
        
    </div>
  </div>

</main>


<!-- Modal -->
<div id="myLoginModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
              <h4 class="modal-title">Connect to SpotKanban</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="member-name">Username</label>
            <input type="text" class="form-control" id="member-name" placeholder="Username">
          </div>
          <div class="form-group">
            <label for="member-password">Password</label>
            <input type="text" class="form-control" id="member-password" placeholder="Password">
          </div>
          <button type="submit" class="btn btn-primary" id="login-modal-button">Connect</button>
      </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>


<!-- Task Modal -->
<div id="myTaskModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
      <h4 class="task-modal-title">Add a task</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="task-name">Name</label>
            <input type="text" class="form-control" id="task-name" placeholder="Task name">
          </div>
          <div class="form-group">
            <label for="task-description">Description</label>
            <input type="text" class="form-control" id="task-description" placeholder="Task description">
          </div>
           <div class="form-group">
          <label for="task-description">Status</label>
           <select class="form-control" id="task-status">
             <option value="" selected disabled hidden>Status</option>
            <option value="BACKLOG">BACKLOG</option>
            <option value="TODO">TODO</option>
            <option value="DOING">DOING</option>
            <option value="DONE">DONE</option>
          </select>
          </div>          
          <button type="submit" class="btn btn-primary" id="task-modal-button"></button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

<script type="text/javascript" charset='utf-8'>

$('#task-modal-button').click(function(){
  
  if($('#task-modal-button').text() == ("Update task")){
    updateTask();
  } else if($('#task-modal-button').text() == ("Add task"))
  {
    addTask();
  }
});


  function addTask(){

  console.log("Enter the addTask method");
  
  var task_id = "ID";
  var task_name = "NAME";
  var task_description = "DESC"; 
  var task_status = "STATUS";

  $.ajax({
      url: '/add_task',
      type: "POST",
      dataType: "json",
        data: {
          "id": task_id,
          "name": task_name,
          "description": task_description,
          "status": task_status
        },
        async: true,
        success: function (data) {
          alert(data);
          console.log("SUCESS Updated task" + task_id  + " " + task_name + " " + task_description + " " + task_status);
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) { 
          alert("Status: " + textStatus); alert("Error: " + errorThrown); 
          console.log("FAIL Updated task" + task_id  + " " + task_name + " " + task_description + " " + task_status);
        } 
    });
}

 function updateTask(){

  console.log("Enter the updateTask method");
  
  var task_id = "ID";
  var task_name = "NAME";
  var task_description = "DESC"; 
  var task_status = "STATUS";

  $.ajax({
      url: '/update_task',
      type: "POST",
      dataType: "json",
        data: {
          "id": task_id,
          "name": task_name,
          "description": task_description,
          "status": task_status
        },
        async: true,
        success: function (data) {
          alert(data);
          console.log("SUCESS Updated task" + task_id  + " " + task_name + " " + task_description + " " + task_status);
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) { 
          alert("Status: " + textStatus); alert("Error: " + errorThrown); 
          console.log("FAIL Updated task" + task_id  + " " + task_name + " " + task_description + " " + task_status);
        } 
    });
}

function modifyTask(index, name, status, description){
    $(".task-modal-title").html("Task : " + name);
    $("#task-name").val(name);
    $('#task-description').val(description);
    $('#task-status').val(status);
    $('#task-modal-button').html("Update task");
    $('#myTaskModal').modal();

}     

function addTask(){
    $(".task-modal-title").html("Add a task");
    $("#task-name").val("");
    $('#task-description').val("");
    $('#task-status').val("");
    $('#task-modal-button').html("Add task");
    $('#myTaskModal').modal();

}     
</script>
{% endblock %}
